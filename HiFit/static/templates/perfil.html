{% extends 'base.html' %}


{% block css %}
	<link rel="stylesheet" href="/static/bootstrap-star-rating/css/star-rating.css">	

	<style>
		.post-container {
			margin-bottom: 30px;
			background-color: #eee;
			border-style: solid;
			border-width: 1px;
			border-radius: 6px;
			border-color: #aaa;
		}

		.post-container .post-usuario {
			padding: 10px;
		}

		.post-container .post-dados {
			padding-left: 10px;
		}

		.post-container p, h4, a {
			padding: 10px 10px 10px 10px;
		}

		.comment-container {
			padding: 5px 5px 5px 5px;
		}

		.comment-container p {
			padding: 5px 0px 5px 5px;			
			margin: 0;
		}

		.comment-container p a {
			padding: 0px 0px 0px 0px;			
			margin: 0;
		}

		.comment-container textarea {
			padding: 5px 0px 0px 5px;			
			margin: 0;
		}

		.hr-black {
			border-color: black;
		}

		.hr-gray2 {
			border-color: #aaa;
		}

		.hr-gray {
			border-color: #ccc;
		}

		.non-margin {
			margin-top: 0;
			margin-bottom: 0;	
		} 

 	    .details li {
	    	list-style: none;
	    	padding-left: none;
	    }

	    .post-container li {
	        margin-bottom:10px;
	    }

	</style>
{% endblock %}

{% block title %}Perfil{% endblock %}
		
{% block titulo %}{% endblock %}

{% block content %}
	<div class="container">    
	    <div class="row">
	        <div class="col-md-3">
	            <img src="https://www.svgimages.com/svg-image/s5/man-passportsize-silhouette-icon-256x256.png" alt="stack photo" class="img img-responsive img-thumbnail">
	        </div>
	        <div class="col-md-9">
	            <div class="container">
	                <h2>{% if perfil_aluno %}Aluno: {% else %}Instrutor: {% endif %}{{ usuario.user.username }}</h2>
		            <ul class="list-inline details align-middle">
	              		{% if perfil_aluno %}
							{% if seguiu %}
								<li><a href="/usuario/dseguir/{{ usuario.id }}" class="btn btn-warning align-middle">Deixar de seguir</a></li>								
							{% else %}
								<li><a href="/usuario/seguir/{{ usuario.user.id }}" class="btn btn-primary align-middle">Seguir</a></li>
							{% endif %}
						{% else %}
							{% if associou %}
								<li><a href="/usuario/dassociar/{{ usuario.id }}" class="btn btn-warning align-middle">De-associar</a></li>								
							{% else %}
								<li><a href="/usuario/associar/{{ usuario.user.id }}" class="btn btn-success">Associar-se</a></li>
							{% endif %}							
						{% endif %}
	              		<li><a href="#" class="btn btn-danger align-middle">Avaliar</a></li>	              		
	            	</ul>
	            </div>
	            <hr class="non-margin">
	            {% if not perfil_aluno %}
		            <div class="col-md-12">
		        		<p>{{ usuario.descricao }}</p>    	
		            </div>
		        {% endif %}
	        </div>
	    </div>
    </div>

	<hr class="hr-black">

	{% if dono %}
	<div class="container">
		<form method="POST" action="/usuario/perfil/">{% csrf_token %}
	        {{ postForm.post }}
	        <div class="form-inline">
	        	{{ postForm.tipo }} 
	        	<input class="btn btn-primary" type="submit" value="Publicar" />
			</div>
		</form>
		<br>
	</div>
	<hr class="hr-black">
	{% endif %}


	{% for p in posts %}
		<div class="post-container" id="post-conteudo">
			<div class="post-content">
				
				<div class="row">
					<div class="col-md-4 nopadding"><p><b>{{ p.usuario.nome }}</b></p></li></div>
					<div class="col-md-8"><p class="pull-right">{{ p.data }}</p></div>
				</div>
				<p>{{ p.conteudo }}</p>
					<div class="post-dados text-right">
						{% if dono %}
							<span><a href="#" class="glyphicon glyphicon-pencil" id="botaoEdita" data-toggle="modal" data-target="#modal-edicao" class="btn btn-danger" type="submit" onclick="setModalEditaPost('{{ p.id }}', '{{ p.conteudo }}', '{{ p.privacidade }}')"></a></span>
							
							<span><a href="#" class="glyphicon glyphicon-trash text-danger" id="botaoExclusao" data-toggle="modal" data-target="#modal-confirma-exclusao-post" class="btn btn-danger" type="submit" onclick="setModalExcluirPost('{{ p.id }}')"></a></span>
						{% endif %}
					</div>
			</div>
			<hr class="hr-gray2 non-margin">
			<div class="post-dados">
				<table style="width: 100%">
					<tr>
						<td>
							{% if p.privacidade != 0 %}
								<span class="glyphicon glyphicon-user" aria-hidden="true"></span>
							{% else %}
								<span class="glyphicon glyphicon-globe" aria-hidden="true"></span>
							{% endif %}	
						</td>
						<td align="right" style="width: 88%;"><span><a href="#">Denunciar</a>| </span> <td>
						<td align="right" style="padding-right: 5px">
							<input id="{{ p.id }}" value="{{ p.classificacao.nota }}" class="rating" step=0.5 min=0 max=5 data-show-clear="false" 
					   			   data-show-caption="false" data-size="xxs"/>
						</td>
					</tr>
				</table>
			</div>

			<div class="comment-container">
				{% if p.comments.all %}
					<hr class="hr-gray2 non-margin">
				{% endif %}
				{% for c in p.comments.all %}
					<p style="font-size: 0.9em;"><a href="/usuario/perfil/?usuario={{ c.usuario.user.username }}">{{ c.usuario.nome }}</a> - {{ c.data }}			
					{% if dono %}
						<a href="#" class="glyphicon glyphicon-trash pull-right btn-xs" id="botaoExclusao" data-toggle="modal" data-target="#modal-confirma-exclusao-comentario" class="btn btn-danger" type="submit" onclick="setModalExcluirComentario('{{ c.id }}')"></a>
					{% endif %}</p>
					<p style="color: #111">{{ c.conteudo }}</p>
				{% endfor %}
				{% if p.comments.all %}
					<hr class="hr-gray2">
				{% endif %}
				<textarea class="form-control form-comentario" type="textarea" id="{{p.id}}c" onkeypress="onKeyDown(event.keyCode, event.shiftKey, {{p.id}});" rows="1" placeholder="Escreva um comentário..." style="resize: none;"></textarea>
			</div>
		</div>
	{% endfor %}
	<div class="pagination">
	    <span class="step-links">
	        {% if posts.has_previous %}
	            <a href="/usuario/perfil/?usuario={{ usuario.user.username }}&page={{ posts.previous_page_number }}"><span class="glyphicon glyphicon-backward" aria-hidden="true"></span></a>
	        {% endif %}

	        <span class="current">
	            {% if posts %}
	            	Página {{ posts.number }} de {{ posts.paginator.num_pages }}.
	            {% endif %}
	        </span>

	        {% if posts.has_next %}
	            <a href="/usuario/perfil?usuario={{ usuario.user.username }}&page={{ posts.next_page_number }}"><span class="glyphicon glyphicon-forward" aria-hidden="true"></span></a>
	        {% endif %}
	    </span>
	</div>

	<div id="modal-confirma-exclusao-post" class="modal fade" role="dialog">
	    <div class="modal-dialog">
	        <div class="modal-content">
	            <form action="/usuario/perfil/" method="POST">{% csrf_token %}
	                <div class="modal-header">
	                    <button type="button" class="close" data-dismiss="modal">&times;</button>
	                    <h4 class="modal-title">Confirmação de exclusão de postagem</h4>
	                </div>
	                <div class="modal-body">
	                    <p>Deseja realmente excluir a sua postagem?</p>
	                </div>
	                <div class="modal-footer">
	                    <div class="pull-left">
                    		<button type="submit" name="excluirPost" id="excluirPost" class="btn btn-success" value="">Confirmar</button>
	                    </div>
	                    <div class="pull-right">
	                        <button type="button" class="btn btn-danger" data-dismiss="modal">Fechar</button>
	                    </div>
	                </div>
	            </form>
	        </div>
	    </div>
	</div>  

	<div id="modal-confirma-exclusao-comentario" class="modal fade" role="dialog">
	    <div class="modal-dialog">
	        <div class="modal-content">
	            <form action="/usuario/perfil/" method="POST">{% csrf_token %}
	                <div class="modal-header">
	                    <button type="button" class="close" data-dismiss="modal">&times;</button>
	                    <h4 class="modal-title">Confirmação de exclusão de comentário</h4>
	                </div>
	                <div class="modal-body">
	                    <p>Deseja realmente excluir o comentario?</p>
	                </div>
	                <div class="modal-footer">
	                    <div class="pull-left">
                    		<button type="submit" name="excluirComentario" id="excluirComentario" class="btn btn-success" value="">Confirmar</button>
	                    </div>
	                    <div class="pull-right">
	                        <button type="button" class="btn btn-danger" data-dismiss="modal">Fechar</button>
	                    </div>
	                </div>
	            </form>
	        </div>
	    </div>
	</div> 

	<!-- Modal edicao -->
	<div id="modal-edicao" class="modal fade" role="dialog">
	    <div class="modal-dialog">
	        <div class="modal-content">
	            <div class="modal-header">
	                <button type="button" class="close" data-dismiss="modal">&times;</button>
	                <h4 class="modal-title">Edição de Post</h4>
	            </div>
	            <div class="modal-body">
	                <form action="/usuario/perfil/" method="POST" id="form-edit">
	                    {% csrf_token %}
	                    <textarea id="edita-conteudo" name="conteudo" rows="3" class="form-control" style="margin-bottom: 10px;"></textarea>
	                    <select class="form-control" id="edita-privacidade" name="tipo" style="width: 90px" required>
							<option value="0">Publico</option>
							<option value="1">Privado</option>
						</select>
						<hr>
						<p>Deseja salvar a edição? </p>
	                    <button type="submit" name="atualiza-post" id="atualiza-post" class="btn btn-primary">Salvar</button>
	                    <button type="button" class="btn btn-danger" data-dismiss="modal">Fechar</button>
	                </form>
	            </div>
	        </div>
	    </div>
	</div>

{% endblock %}

{% block js %}

	<script>
		function onKeyDown(e, s, id) {
			if (e == 13) {
				$.ajax({
					type: 'POST',
					url: '/usuario/perfil/',
					data: {
						'csrfmiddlewaretoken': '{{ csrf_token }}',
						'comentario': 'comentario',
						'conteudo': $('#'+id+'c').val(),
						'id': id
					}
				});
				$('#'+id+'c').val('');
				location.reload();
    		}
    	};
	</script>

	<script>
	    $(document).ready(function() {
	        $('.rating').on('rating.change', function(event, value, caption) {
	            avaliarPost($(this).attr("id"), value);
	        });
	    });
	</script>

    <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <script src='/static/bootstrap-star-rating/js/star-rating.js'></script>
	<script src='/static/js/posts.js'></script>
{% endblock %}


