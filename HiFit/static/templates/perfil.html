{% extends 'base.html' %}


{% block css %}
	<style>
		.post-container {
			margin-bottom: 30px;
			background-color: #eee;
			border-style: solid;
			border-width: 1px;
			border-radius: 6px;
			border-color: #aaa;
		}

		.post-container .post-usuario {
			padding: 10px;
		}

		.post-container .post-dados {
			padding-bottom: 10px;
			padding-right: 10px;
		}

		.post-container p, h4, a {
			padding: 10px 10px 10px 10px;
		}

		.hr-black {
			border-color: black;
		}

		.hr-gray {
			border-color: #ccc;
		}

		.non-margin {
			margin-top: 0;
		} 

 	    .details li {
	    	list-style: none;
	    	padding-left: none;
	    }

	    li {
	        margin-bottom:10px;
	    }
	</style>

	<link rel="stylesheet" href="/static/bootstrap-star-rating/css/star-rating.css">
{% endblock %}

{% block title %}Perfil{% endblock %}
		
{% block titulo %}{% endblock %}

{% block content %}
	<div class="container">    
	    <div class="row">
	        <div class="col-md-3">
	            <img src="https://www.svgimages.com/svg-image/s5/man-passportsize-silhouette-icon-256x256.png" alt="stack photo" class="img img-responsive img-thumbnail">
	        </div>
	        <div class="col-md-9">
	            <div class="container">
	                <h2>{% if perfil_aluno %}Aluno: {% else %}Instrutor: {% endif %}{{ usuario.user.username }}</h2>
		            <ul class="list-inline details align-middle">
	              		{% if perfil_aluno %}
	              			{% if aluno %}
								{% if seguiu %}
									<li><a href="/usuario/dseguir/{{ usuario.id }}" class="btn btn-warning align-middle">Deixar de seguir</a></li>
								{% else %}
									<li><a href="/usuario/seguir/{{ usuario.user.id }}" class="btn btn-primary align-middle">Seguir</a></li>
								{% endif %}
							{% elif not aluno and meu_aluno %}
								<label for="input-7-xs" class="control-label">Avaliação atual</label>
								<input id="display_only" name="input-3" value="{{perfil_avaliacao}}" class="rating-loading">
								<label for="input-7-xs" class="control-label">Avalie este aluno</label>
								<input id={{usuario.id}}
                                       value="0"
                                       class="rating"
                                       min=0
                                       max=5
                                       step=0.5
                                       data-size="xs">
                                <br>
							{% endif %}
						{% else %}
							{% if associou %}
								<li><a href="/usuario/dassociar/{{ usuario.id }}" class="btn btn-warning align-middle">De-associar</a></li>
								<br>
								<label for="input-7-xs" class="control-label">Avaliação atual</label>
								<input id="display_only" name="input-3" value="{{perfil_avaliacao}}" class="rating-loading">
								<label for="input-7-xs" class="control-label">Avalie este instrutor</label>
								<input id={{usuario.id}}
                                       value="0"
                                       class="rating"
                                       min=0
                                       max=5
                                       step=0.5
                                       data-size="xs">
                                <br>
							{% else %}
								<li><a href="/usuario/associar/{{ usuario.user.id }}" class="btn btn-success">Associar-se</a></li>
							{% endif %}							
						{% endif %}	              		
	            	</ul>
	            </div>
	            <hr class="non-margin">
	            {% if not perfil_aluno %}
		            <div class="col-md-12">
		        		<p>{{ usuario.descricao }}</p>    	
		            </div>
		        {% endif %}
	        </div>
	    </div>
    </div>

	<hr class="hr-black">
	{% for p in posts %}
		<div class="post-container">
			<div class="post-content">
				
				<div class="row">
					<div class="col-md-4 nopadding"><p><b>{{ usuario }}</b></p></li></div>
					<div class="col-md-8"><p class="pull-right">{{ p.data }}</p></div>
				</div>
				<p>{{ p.conteudo }}</p>
				<div class="row">
					<div class="col-md-12 col-md-offset-11 post-dados">
						<a href="#">
							<span class="glyphicon glyphicon-star" aria-hidden="true"></span>
						</a>
						{% if p.privacidade != 0 %}
							<span class="glyphicon glyphicon-user" aria-hidden="true"></span>
						{% else %}
							<span class="glyphicon glyphicon-globe" aria-hidden="true"></span>
						{% endif %}
					</div>
				</div>
			</div>
		</div>
	{% endfor %}
	<div class="pagination">
	    <span class="step-links">
	        {% if posts.has_previous %}
	            <a href="/usuario/perfil/?usuario={{ usuario.user.username }}&page={{ posts.previous_page_number }}"><span class="glyphicon glyphicon-backward" aria-hidden="true"></span></a>
	        {% endif %}

	        <span class="current">
	            {% if posts %}
	            	Página {{ posts.number }} de {{ posts.paginator.num_pages }}.
	            {% endif %}
	        </span>

	        {% if posts.has_next %}
	            <a href="/usuario/perfil?usuario={{ usuario.user.username }}&page={{ posts.next_page_number }}"><span class="glyphicon glyphicon-forward" aria-hidden="true"></span></a>
	        {% endif %}
	    </span>
	</div>

	<script>
	    $(document).ready(function() {
	        $('#display_only').rating({displayOnly: true, step : 0.5});
	        $('.rating').on('rating.change', function(event, value, caption) {
	            avaliarUsuario("{{usuario.user.username}}",value);
	        });
	        $('.rating').on('rating.clear', function(event) {
	            avaliarUsuario("{{usuario.user.username}}", 0.0);
	        });
	    });
	    $( document ).ajaxComplete(function(r) {
		  $("body").html(r.responseText);
		});
	</script>
{% endblock %}

{% block js %}
	<script src='/static/bootstrap-star-rating/js/star-rating.js'></script>
	<script src='/static/js/avalia_usuario.js'></script>
{% endblock %}
